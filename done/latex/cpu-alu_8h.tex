\hypertarget{cpu-alu_8h}{}\section{cpu-\/alu.h File Reference}
\label{cpu-alu_8h}\index{cpu-\/alu.\+h@{cpu-\/alu.\+h}}


C\+PU model for P\+P\+S-\/\+G\+Bemul project, A\+LU part.  


{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include \char`\"{}alu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}cpu.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}error.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}opcode.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}cpu-\/storage.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}cpu-\/registers.\+h\char`\"{}}\newline
Include dependency graph for cpu-\/alu.h\+:
% FIG 0
This graph shows which files directly or indirectly include this file\+:
% FIG 1
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{cpu-alu_8h_a2b571a60eade9bd62f819f0ac4fde50b}\label{cpu-alu_8h_a2b571a60eade9bd62f819f0ac4fde50b}} 
\#define \hyperlink{cpu-alu_8h_a2b571a60eade9bd62f819f0ac4fde50b}{A\+D\+D\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   C\+L\+E\+AR, A\+LU,   A\+LU
\begin{DoxyCompactList}\small\item\em Macros for flag sources for A\+LU operations (Z\+N\+HC) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{cpu-alu_8h_a24d828827dc92d1ec35b600aea7e2d35}\label{cpu-alu_8h_a24d828827dc92d1ec35b600aea7e2d35}} 
\#define {\bfseries I\+N\+C\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   C\+L\+E\+AR, A\+LU,   C\+PU
\item 
\mbox{\Hypertarget{cpu-alu_8h_aab5c090154425839c3c715f9225254e8}\label{cpu-alu_8h_aab5c090154425839c3c715f9225254e8}} 
\#define {\bfseries S\+U\+B\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   S\+ET,   A\+LU,   A\+LU
\item 
\mbox{\Hypertarget{cpu-alu_8h_ae3324c6b158f162841d809d3c6c531f9}\label{cpu-alu_8h_ae3324c6b158f162841d809d3c6c531f9}} 
\#define {\bfseries D\+E\+C\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   S\+ET,   A\+LU,   C\+PU
\item 
\mbox{\Hypertarget{cpu-alu_8h_a07755702907009b3b081b476703cd083}\label{cpu-alu_8h_a07755702907009b3b081b476703cd083}} 
\#define {\bfseries A\+N\+D\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   C\+L\+E\+AR, S\+ET,   C\+L\+E\+AR
\item 
\mbox{\Hypertarget{cpu-alu_8h_a09b09f9edf41d212ab211df5e83393d3}\label{cpu-alu_8h_a09b09f9edf41d212ab211df5e83393d3}} 
\#define {\bfseries O\+R\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   C\+L\+E\+AR, C\+L\+E\+AR, C\+L\+E\+AR
\item 
\mbox{\Hypertarget{cpu-alu_8h_ab1ce33877a2a84e3349ecbb55ed68a66}\label{cpu-alu_8h_ab1ce33877a2a84e3349ecbb55ed68a66}} 
\#define {\bfseries D\+A\+A\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   C\+PU,   C\+L\+E\+AR, A\+LU
\item 
\mbox{\Hypertarget{cpu-alu_8h_a2837178816f9737cd3808d8ef41401f0}\label{cpu-alu_8h_a2837178816f9737cd3808d8ef41401f0}} 
\#define {\bfseries R\+O\+T\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~C\+L\+E\+AR, C\+L\+E\+AR, C\+L\+E\+AR, A\+LU
\item 
\mbox{\Hypertarget{cpu-alu_8h_ac95614cd2738287600aa6a24616d9da9}\label{cpu-alu_8h_ac95614cd2738287600aa6a24616d9da9}} 
\#define {\bfseries S\+H\+I\+F\+T\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   C\+L\+E\+AR, C\+L\+E\+AR, A\+LU
\item 
\mbox{\Hypertarget{cpu-alu_8h_a090bbca7207d0de64aa21309b7bc9eea}\label{cpu-alu_8h_a090bbca7207d0de64aa21309b7bc9eea}} 
\#define {\bfseries A\+L\+L\+\_\+\+A\+L\+U\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC}~A\+LU,   A\+LU,   A\+LU,   A\+LU
\item 
\#define \hyperlink{cpu-alu_8h_a23ade8162e2334e23894c4a1fb23c834}{combine\+\_\+flags\+\_\+set\+\_\+A}(cpu, ...)
\begin{DoxyCompactList}\small\item\em some useful macros\+: \end{DoxyCompactList}\item 
\mbox{\Hypertarget{cpu-alu_8h_a162a740408ccd75dba4f7b918fcf5e9c}\label{cpu-alu_8h_a162a740408ccd75dba4f7b918fcf5e9c}} 
\#define {\bfseries O\+P\+C\+O\+D\+E\+\_\+\+C\+A\+R\+R\+Y\+\_\+\+I\+DX}~3
\item 
\mbox{\Hypertarget{cpu-alu_8h_ae72e429464d29d1b2ed70580e3f9be5e}\label{cpu-alu_8h_ae72e429464d29d1b2ed70580e3f9be5e}} 
\#define {\bfseries extract\+\_\+carry}(cpu,  op)~(\hyperlink{bit_8h_afa7f855f3ed3b9234b74bc3805cc82e3}{bit\+\_\+get}(op, O\+P\+C\+O\+D\+E\+\_\+\+C\+A\+R\+R\+Y\+\_\+\+I\+DX) \&\& get\+\_\+C((cpu)-\/$>$F))
\item 
\#define {\bfseries do\+\_\+cpu\+\_\+arithm}(cpu,  op,  arg,  flags\+\_\+src)
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}\label{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}} 
enum \hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t} \{ {\bfseries C\+L\+E\+AR}, 
{\bfseries S\+ET}, 
{\bfseries A\+LU}, 
{\bfseries C\+PU}
 \}\begin{DoxyCompactList}\small\item\em Enum for the various flag values. \end{DoxyCompactList}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{cpu-alu_8h_ab160349665b976fd9744ef060ec11b34}{cpu\+\_\+dispatch\+\_\+alu} (const \hyperlink{structinstruction__t}{instruction\+\_\+t} $\ast$lu, \hyperlink{structcpu__t}{cpu\+\_\+t} $\ast$cpu)
\begin{DoxyCompactList}\small\item\em Executes an A\+LU instruction. \end{DoxyCompactList}\item 
int \hyperlink{cpu-alu_8h_ac780d6a4222a48f38ef077b29ca9dca2}{cpu\+\_\+combine\+\_\+alu\+\_\+flags} (\hyperlink{structcpu__t}{cpu\+\_\+t} $\ast$cpu, \hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t} Z, \hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t} N, \hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t} H, \hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t} C)
\begin{DoxyCompactList}\small\item\em Combine flag sources and write them to F register. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
C\+PU model for P\+P\+S-\/\+G\+Bemul project, A\+LU part. 

\begin{DoxyAuthor}{Author}
J.-\/C. Chappelier \& C. HÃ¶lzl, E\+P\+FL 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2019 
\end{DoxyDate}


\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{cpu-alu_8h_a23ade8162e2334e23894c4a1fb23c834}\label{cpu-alu_8h_a23ade8162e2334e23894c4a1fb23c834}} 
\index{cpu-\/alu.\+h@{cpu-\/alu.\+h}!combine\+\_\+flags\+\_\+set\+\_\+A@{combine\+\_\+flags\+\_\+set\+\_\+A}}
\index{combine\+\_\+flags\+\_\+set\+\_\+A@{combine\+\_\+flags\+\_\+set\+\_\+A}!cpu-\/alu.\+h@{cpu-\/alu.\+h}}
\subsubsection{\texorpdfstring{combine\+\_\+flags\+\_\+set\+\_\+A}{combine\_flags\_set\_A}}
{\footnotesize\ttfamily \#define combine\+\_\+flags\+\_\+set\+\_\+A(\begin{DoxyParamCaption}\item[{}]{cpu,  }\item[{}]{... }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{ \(\backslash\)
        M\_EXIT\_IF\_ERR(\hyperlink{cpu-alu_8h_ac780d6a4222a48f38ef077b29ca9dca2}{cpu\_combine\_alu\_flags}(cpu, \_\_VA\_ARGS\_\_)); \(\backslash\)
        cpu->A = \hyperlink{bit_8h_aa7214f9bc705f6d655fafa3a15f672e8}{lsb8}(cpu->alu.value); \(\backslash\)
    \} \textcolor{keywordflow}{while}(0)
\end{DoxyCode}


some useful macros\+: 


\begin{DoxyItemize}
\item combine\+\_\+flags\+\_\+set\+\_\+A\+: used in do\+\_\+cpu\+\_\+arithm to combine A\+LU flags, set F and set A
\item extract\+\_\+carry\+: used in do\+\_\+cpu\+\_\+arithm to to extract carry bit from opcode
\item do\+\_\+cpu\+\_\+arithm\+: does(=applies) operation OP from A\+LU on C\+PU using A\+RG as operation argument and F\+L\+A\+G\+S\+\_\+\+S\+RC flag sources (see for instance A\+D\+D\+\_\+\+F\+L\+A\+G\+S\+\_\+\+S\+RC macro above\+: this are the flag sources to be used for A\+DD operations.) 
\end{DoxyItemize}\mbox{\Hypertarget{cpu-alu_8h_a17d3fcdb93f05da139232c07b227dbbf}\label{cpu-alu_8h_a17d3fcdb93f05da139232c07b227dbbf}} 
\index{cpu-\/alu.\+h@{cpu-\/alu.\+h}!do\+\_\+cpu\+\_\+arithm@{do\+\_\+cpu\+\_\+arithm}}
\index{do\+\_\+cpu\+\_\+arithm@{do\+\_\+cpu\+\_\+arithm}!cpu-\/alu.\+h@{cpu-\/alu.\+h}}
\subsubsection{\texorpdfstring{do\+\_\+cpu\+\_\+arithm}{do\_cpu\_arithm}}
{\footnotesize\ttfamily \#define do\+\_\+cpu\+\_\+arithm(\begin{DoxyParamCaption}\item[{}]{cpu,  }\item[{}]{op,  }\item[{}]{arg,  }\item[{}]{flags\+\_\+src }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{ \(\backslash\)
        M\_EXIT\_IF\_ERR(op(&cpu->alu, cpu->A, (arg), extract\_carry(cpu, lu->opcode))); \(\backslash\)
        combine\_flags\_set\_A(cpu, flags\_src); \(\backslash\)
    \} \textcolor{keywordflow}{while}(0)
\end{DoxyCode}


\subsection{Function Documentation}
\mbox{\Hypertarget{cpu-alu_8h_ac780d6a4222a48f38ef077b29ca9dca2}\label{cpu-alu_8h_ac780d6a4222a48f38ef077b29ca9dca2}} 
\index{cpu-\/alu.\+h@{cpu-\/alu.\+h}!cpu\+\_\+combine\+\_\+alu\+\_\+flags@{cpu\+\_\+combine\+\_\+alu\+\_\+flags}}
\index{cpu\+\_\+combine\+\_\+alu\+\_\+flags@{cpu\+\_\+combine\+\_\+alu\+\_\+flags}!cpu-\/alu.\+h@{cpu-\/alu.\+h}}
\subsubsection{\texorpdfstring{cpu\+\_\+combine\+\_\+alu\+\_\+flags()}{cpu\_combine\_alu\_flags()}}
{\footnotesize\ttfamily int cpu\+\_\+combine\+\_\+alu\+\_\+flags (\begin{DoxyParamCaption}\item[{\hyperlink{structcpu__t}{cpu\+\_\+t} $\ast$}]{cpu,  }\item[{\hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t}}]{Z,  }\item[{\hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t}}]{N,  }\item[{\hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t}}]{H,  }\item[{\hyperlink{cpu-alu_8h_a4c967c3e85658e567133a3f087ad8da9}{flag\+\_\+src\+\_\+t}}]{C }\end{DoxyParamCaption})}



Combine flag sources and write them to F register. 


\begin{DoxyParams}{Parameters}
{\em cpu} & cpu source and target to use \\
\hline
{\em Z} & flag source for Z flag bit \\
\hline
{\em N} & flat source for N flag bit \\
\hline
{\em H} & flag source for H flag bit \\
\hline
{\em C} & flag source for C flag bit\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Error code 
\end{DoxyReturn}
\mbox{\Hypertarget{cpu-alu_8h_ab160349665b976fd9744ef060ec11b34}\label{cpu-alu_8h_ab160349665b976fd9744ef060ec11b34}} 
\index{cpu-\/alu.\+h@{cpu-\/alu.\+h}!cpu\+\_\+dispatch\+\_\+alu@{cpu\+\_\+dispatch\+\_\+alu}}
\index{cpu\+\_\+dispatch\+\_\+alu@{cpu\+\_\+dispatch\+\_\+alu}!cpu-\/alu.\+h@{cpu-\/alu.\+h}}
\subsubsection{\texorpdfstring{cpu\+\_\+dispatch\+\_\+alu()}{cpu\_dispatch\_alu()}}
{\footnotesize\ttfamily int cpu\+\_\+dispatch\+\_\+alu (\begin{DoxyParamCaption}\item[{const \hyperlink{structinstruction__t}{instruction\+\_\+t} $\ast$}]{lu,  }\item[{\hyperlink{structcpu__t}{cpu\+\_\+t} $\ast$}]{cpu }\end{DoxyParamCaption})}



Executes an A\+LU instruction. 


\begin{DoxyParams}{Parameters}
{\em lu} & instruction \\
\hline
{\em cpu,the} & C\+PU which shall execute \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
error code 
\end{DoxyReturn}
